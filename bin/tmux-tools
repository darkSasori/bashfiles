#!/bin/bash

cmd=$1
session=$2

LIST_PANE='tmux list-panes -a -F "#{session_name}:#{window_name}:#I:#{pane_top}:#{pane_left}:#{pane_current_path}"'
LIST_PANE_FILTER="$LIST_PANE|grep \"^$session\""

if [ ! -d ~/.tmux-sessions ]; then
    mkdir ~/.tmux-sessions
fi

help() {
    echo "usage: $0 [save | restore | rm | list]";
    exit 1;
}

get_field() {
    case $2 in
        "session") i=1; ;;
        "window") i=2; ;;
        "index") i=3; ;;
        "top") i=4; ;;
        "left") i=5; ;;
        "path") i=6; ;;
        *) echo "$2 not found"; exit 1; ;;
    esac
    echo $(echo $1 |cut -d':' -f$i)
}

if [ -z $session ] && [ -z "$cmd" ]; then
    help
fi;

case $cmd in
    "save")
        list_pane=$(tmux list-panes -a -F "#{session_name}:#{window_name}:#{window_layout}:#{pane_current_path}"| grep $session)
        echo $list_pane
        echo $cmd_tmux > ~/.tmux-sessions/$session
        ;;
    "restore")
        if [ ! -f ~/.tmux-sessions/$session ]; then
            echo "$session not found";
            exit 1;
        fi
        eval $(cat ~/.tmux-sessions/$session);
        ;;
    "rm")
        rm ~/.tmux-sessions/$session;
        ;;
    "list")
        list=$(ls -1 ~/.tmux-sessions)
        if [ ! -z "$list" ]; then
            echo -e '\e[32mSAVED PANES\e[0m'
            for i in $list; do echo -e '\t'$i; done;
        fi

        list_p=$(tmux list-panes -a -F "#{session_name}:#{window_name}")
        if [ ! -z "$list_p" ]; then
            echo -e '\e[31mTMUX PANES\e[0m'
            for i in $list_p; do echo -e '\t'$i; done;
        fi
        ;;
esac
